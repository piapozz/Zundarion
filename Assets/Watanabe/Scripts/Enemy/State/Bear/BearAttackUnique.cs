using System.Collections;
using System.Collections.Generic;
using Unity.VisualScripting;
using UnityEngine;

public class BearAttackUnique : IEnemyState
{
    float animCount = 0.0f;
    float happenCount = 1.5f;
    bool onceFlag = false;

    CreateCollision.AttackData attackData;

    public EnemyBase.EnemyStatus Action(EnemyBase.EnemyStatus enemyStatus)
    {
        // アニメーションを再生するtriggerを有効化
        enemyStatus.m_animator.SetTrigger("AttackUnique");

        // アニメーションの現在時間を計算
        animCount += enemyStatus.m_animatorState.speed * Time.deltaTime;

        // 当たり判定の発生
        if(animCount > happenCount && onceFlag != true)
        {
            // AttackDataの設定
            attackData.position = enemyStatus.m_position;
            attackData.radius = 1.0f;
            attackData.time = 2.0f;
            attackData.layer = enemyStatus.m_collisionAction.collisionLayers[(int)CollisionAction.CollisionLayer.ENEMY_ATTACK];
            attackData.tagname = enemyStatus.m_collisionAction.collisionTags[(int)CollisionAction.CollisionTag.ATTACK_DANGEROUS];

            // 当たり判定の発生
            CreateCollision.instance.CreateCollisionSphere(enemyStatus.m_gameObject, attackData);
            // 発生を一度だけに制限する
            onceFlag = true;
        }

        // アニメーションの再生が終了したら
        if (enemyStatus.m_animatorState.length < animCount)
        {
            // ステートを切り替える
            enemyStatus.m_state = (int)EnemyBase.EnemyStatus.ActionState.STATE_TRACKING;
        }

        // 更新された情報を返す
        return enemyStatus;
    }
}
